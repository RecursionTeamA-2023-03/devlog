# Recursion 上級者チーム開発 3/11 ~ 4/21 - Team-A 議事録
## 概要
ソフトウェアエンジニアは、ソフトウェアを設計しモデル化するために、ダイアグラムを使用します。  
最も一般的に使用される図には、以下のようなものがあります。ユースケース、クラス、アクティビティ、状態、コンポーネント、グラフ（ネットワーク）、ワイヤーフレーム、ガント、マインドマップなどです。  
このようなソフトウェアのモデリングや設計のための図をテキストで作成できるサービスをPlantUMLを活用して作成します。PlantUMLは、平易な英語のテキストを図に変換するプログラムです。   
このサービスは、ユーザにテキストエディタを提供し、特定のシンタックスを記述させ、ダイアグラムを返すようにします。これらの図は、SVG、PNG、またはASCIIとして見ることができます。  

## 要件定義
### 機能要件
+ PlantUMLのシンタックスを使って、ユースケース図、クラス図、アクティビティ図、状態図、マインドマップ図、グラント図を作成します。
+ ユーザーは、コードエディタを通してPlantUMLを記述します。
+ ライブフィードバックオプションを提供し、ユーザが書いた図がどのように見えるかを確認することができます。
+ ユーザーが作成した図の.png, .svg, .txtファイルをダウンロードできるようにします。
+ オペレーティングシステムにおけるディレクトリ／ファイルと同様の方法で、ダイアグラム・プロジェクトの保存、編集、削除を可能にすることで、ユーザーがタスクを管理できるようにします。
+ ~~作業中のダイアグラムの構文を説明するチートシートを提供します。~~
+ アクティビティ図、状態図、グラント図のインタラクティブなチュートリアルをユーザーに提供します。
+ プロンプトと最終結果のダイアグラムを表示する練習用プロンプトジェネレーターを提供します。

### 非機能要件
+ コンポーネント図やデプロイ図など、より多くの種類の図を追加するために、サービスは簡単に拡張できる必要があります。
+ サーバーのストレージリソースは限られているので、サービスはストレージ効率に優れている必要があります。最初の制限は25GBですが、10万人の同時接続ユーザーを処理する必要があります。
+ チートシートは、簡潔でわかりやすく、~~かつ現在使われているダイアグラムを作成するために必要な構文をすべて含んでいなければなりません。~~
+ チュートリアルで、ダイアグラムの書き方を短時間で効果的に学ぶことができます。
+ このサービスは、専門用語に詳しくない人でも、チュートリアルやプロンプトを簡単に追加できるように設計されます。

## 議事録
### 3/11: キックオフミーティング
1. 開発課題の把握    
PlantUMLを使用して、テキストからのダイアグラム画像生成サイトの構築。   
フロントエンドでユーザーからの入力等を受け取り、バックエンドから画像を生成してフロントに返す簡単なアプリをまずは作る。同時接続数の問題は後の課題。   
すでにPlantUMLを使った画像生成のnpm moduleがあるため、バックエンドではそれを活用できる。またバックエンドでユーザーの認証と過去の作成データを閲覧・編集等できるようにする。

2. 技術スタック   
- Frontend: TypeScript + React
- Backend: TypeScript + Node.js + express
- DB: MongoDB
- 環境環境: Docker
- deploy: Netlify, GCP  

3. 次回までのToDo. 
- フロントエンドのモックデザイン
- 開発環境用コンテナ等の作成
- PlantUMLを実際に使用して学ぶ

4. 次回ミーティング     
3/15　20:00. 

### 3/15: 第2回ミーティング
1. ワイヤーフレームと要件の再検討    
    1. ログインページ　　  
        - このままでOK。今後、認証機能を開発した時にフォームの記入項目等の詳細を決定する。        
    2. 作業ページ    
        - 全体的にこのレイアウトで問題なし。    
        - テンプレートはユーザーにとっても良いので採用したい。    
        - チームでのプロジェクト共有は良いが、アプリ内での公開・非公開や検索機能は現状必要ないと思われる。   
        - ダイアグラムの編集画面中に作成中のダイアグラムに関するチートシートを表示するか否か。ユーザーが自身でドキュメントページに移動すれば良いのではないか。    
        - 余裕があれば＋αの機能として、チャット形式でユーザーが作成したいダイアグラムの情報を取得してplantUMLシンタックスとUML図を自動生成する機能を実装してはどうか。　　　　
    3. 学習ページ＆ドキュメントページ   
        - 練習問題へのリンクをただリストとして並べるより、簡単なシンタックスの説明＋練習問題へのリンクの方が良いのではないか。しかし、ドキュメントページとの差別化が難しいので現状でも良いのでは。   
        - 学習ページとドキュメントページとPlantUMLサイトのドキュメントの内容をどのように差別化するか。現状では、学習ページは簡単な問題によるシンタックスのアウトプット、ドキュメントページでチートシート、詳しい説明をPlantUMLのドキュメントという区別で良いのではないか。    
    4. 機能要件   
        - 現在作業中の図に関するチートシートの提示は、今回は良いのではないか。ドキュメントページからユーザーが自分で該当箇所を探すので対応してもらう。
        
    5. 非機能要件    
        - 上述を同じく、現在作業中のチートシートは提示しない。
        - その他全て達成可能と考える。しかし、同時接続数などは達成証明として今後負荷テストなどの導入を検討すべき。

2. 技術スタックの再検討   
    今回作成するアプリは作業ページはCSRで、その他のページはSSGで静的に生成しておけるのでNode.jsサーバーで自作のバックエンドを構築する代わりにNext.jsを使用する方針に変更する。   
    フロントエンドのスタイルはstyled-componentsを使用する。    
    バックエンドとして必要な機能である①認証機能はBaasの機能を使用　②DB操作や③plantUML moduleの実行はNext.jsでAPIを作成する。    
    TypescriptでDB操作をするため、ORMとしてPrismaを使用。     
    Next.jsとの親和性からデプロイ先はVercel、RDBを使用して柔軟にDBカラムを操作したいのでBaaSはSupabaseを選択。    
    バックエンドサーバーを作る必要がないので、今回はコンテナによる開発はしない。    
    - Frontend: TypeScript + React + Next.js + styled-components    
    - Backend: TypeScript + Next.js + Prisma + Supabase   
    - DB: Postgresql(Supabase)    
    - デプロイ先: Vercel   
3. 全体スケジュールの確認    
    - 3/18までに各ページで必要となる開発作業を洗い出してイシューとしてまとめる。   
    - 3/18〜4/1の二週間でプロトタイプを完成させる。その後、問題があれば再開発。問題等なければ静的コンテンツの充実化やテストの追加など方針を再検討する。    
4. 課題   
    - チートシートとしてplantUMLのシンタックスの要約。    
    - DBテーブルでのプロジェクトのグループ利用対応。    
    - テーブルの[id問題](https://docs.google.com/document/d/1q54M_LNUYPhSW8KSKEQkl5MHwzAHUcLvj6VMIe26XXU/edit?usp=sharing)   
5. 次回ミーティング   
3/18 20:00    

### 3/18: 第3回ミーティング
1. 洗い出したイシューの確認    
    - 各ページのフロント部分のatomic designに基づいたコンポーネントタスクが洗い出せた。
    - バックエンドとしての開発すべき要素（認証機能やAPI）を暫定で洗い出せた。
    - 各自がそれぞれ空いているイシューを消化していく。バックエンドが優先度が高め。 
2. 次回ミーティング   
3/22 17:00    

### 3/22: 第4回ミーティング
1. 進捗確認    
    -  atomsのコンポーネントを作成し出した。現状でデフォルト値がなく、ほとんどがoptionalなpropsを受け付ける形になっているので、まずdefault値を決めたコンポーネントを作成するように修正する（例：　テキスト用コンポーネントは文字サイズを大中小の３サイズをデフォルトで用意する）。
    - プロジェクトのグループ利用に対応したdbを一旦作成したが、認証機能と合わせて実装するために再度修正を加える。
    - plantUmlの提供するダイアグラム生成ソフトをnode上で実行できるnpmを用いてダイアグラム画像生成APIを作成、簡易的にエディタと生成画像が表示されるようにして確認。   
2. 課題   
    - 画像生成で使用しているnpmはインストール時にplantUmlの.jarファイルをインストールし、node.jsで記述されたコードから呼び出し実行していた。そのため、このアプリを実行する環境自体が実行環境としてJavaをインストールしていなければ画像生成できないことが分かった。予定していたdeploy先のvercelはAPIが実行されるサーバーレス関数のランタイムにJavaが対応していないため、画像生成API用にバックエンドサーバーを立てる等の対策が必要。Supabaseの利用も再検討すべきかもしれない。
    - また、plantUmlの実行ファイルはOSSソフトのGraphVizをインストールしていないと多くの種類のダイアグラムが生成できないことが分かった。バックエンドサーバーにはこの点も合わせて考慮する必要がある。
    - 画像生成のライブフィードバックはAPIの呼び出しが多くなるため、画像のレスポンスが遅くなるので対策が必要。
3. 次回ミーティング   
3/25 20:00    

### 3/25: 第5回ミーティング
1. 進捗確認  
    - 作業ページ
        AtomicデザインのTemplateからページを作成した。moleculeやatomへ完全に分離できていないため、今後atomic designとしてコンポーネントを細分化する。APIが現在ないため、全てをステートとして管理しており、propsリレーで子コンポーネントに渡している。今後バックエンドが開発できればapiを所定の場所で呼び出すように修正する。尚、テンプレートボードはテンプレートデータが無いため何も表示していない。
        
    - 学習ページ    
        ボタン、アイコン、テキストのAtomコンポーネントを作成した。尚、デフォルト値を与えるように修正した。アイコンは現在ページ内で使用する予定のものを全てexportしている。全ページに使用できるHeaderを追加した。
        アイコンに画像データを使うかmui/iconのようなsvgを使うか議論があった。画像データは種類が豊富という利点があるが、mui/iconのsvgであればhtml要素として柔軟にスタイリングできるのでsvgを使用する。
        mui/iconを使うのに加えて、muiをデザインコンポーネントとして使っても良い。現在のstyled-componentで１からデザインを作るのは大変なので、muiコンポーネントをstyled-componentで適宜修正すれば良いでのでは？
    - 認証ページ
        認証用のページとミドルウェアをSupabaseに記載されたNext.jsでの方法で実装した。しかしながら、Prismaでauthスキーマとpubicスキーマを跨ぐマルチスキーマで作成したスキーマモデルでSupabase上でのユーザー登録ができない。全員で確認したが原因が掴めず。
2. 課題と今後の方針   
    - 当初予定していたプロトタイプの作成（4/1まで）スケジュールから大きく遅れている。atomic designに拘り全体像が見えていない中でのボトムアップ的開発になっているのでフロントエンドの開発が遅れている。各ページのプロトタイプを早急に作成する方針に変更する。細部はその後適宜修正する。
    - Supabase + Next.js + Prismaの技術構成であったが、①node-plantUmlが使用できないため別のバックエンドサーバーが必要、②認証機能の実装に問題がありSupabase + Prismaが上手く使用できない、この2点の課題があるため、技術スタックを新たにしてバックエンド開発をやり直す。BaaSを用いずにバックエンドサーバーを作成するので開発環境にDockerコンテナを導入する。
3. 新しい技術スタック
    - Frontend: Next.js + Typescript
    - Backend: Nest.js
    - deploy: Vercel(Next.js), AWS(Nest.js, Postgresql)
4. 次回ミーティング   
3/29 20:00    

### 3/29: 第6回ミーティング
1. 進捗確認  
    - Dockerコンテナ
        Nest.jsサーバー、Postgresql　DBサーバー、NginxプロキシサーバーのそれぞれのコンテナをComposeしたものとした。Nginxは負荷分散やNext.jsのフロントエンドもAWSにデプロイするなどの変更があった際にはフロントとバックエンドのルーティングが可能となるため暫定的に設置しているがデプロイ方法によっては不必要になるためその場合は排除する。基本はコンテナ間の通信とクライアントからのNginxへのアクセスのみとなるのでホストOSとのポート接続は現在はNginxの80番のみ。
    - 学習ページ    
        サイドバーやパンくずリストでページ遷移ができるレイアウトを作成。ユーザーが回答する問題のデータ保持について相談。現状は問題を解き直すことや書いた内容を見返すことは想定しないのでデータ保持はしない。また問題文の掲載方法について、問題の平易な説明文と見本解答画像の両方を提示する。
    - ドキュメントページ
        チートシートとして使用できるドキュメントページを作成。ドキュメントというよりはチートシートとして使って行くこととする。そのため、見本コードと結果出力を一対一対応で並べる。また、内容は可能は限り網羅的とする。サイドバーやパンくずリストのようなユーザーが該当箇所にすぐアクセスできるように機能を追加してプロトタイプとして完成させる。
2. 課題と方針   
    - 認証やDB操作のAPIを早急に作成する。
    - 学習ページとチートシートページ（ドキュメントページから名称を改める）のSSGに使用する静的データはpublicフォルダ化に各ページ用のフォルダを作成してmarkdownなどのテキストファイルで保存・追加する。
    - エディタとしてmonacoエディタを使用する際に、他の方が開発したplantUML用の拡張機能を搭載すればシンタックスハイライティングなどの機能が使えるので本アプリへの実装に挑戦する。next.jsの設定との競合が発生するため注意が必要。
3. 次回ミーティング   
4/2 20:00    
